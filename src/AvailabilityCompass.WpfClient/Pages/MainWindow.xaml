<Window x:Class="AvailabilityCompass.WpfClient.Pages.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AvailabilityCompass.WpfClient.Pages"
        Width="1360"
        Height="950"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}"
        FontFamily="{materialDesign:MaterialDesignFont}"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="{DynamicResource ShadcnBackgroundBrush}"
        Loaded="MainWindow_Loaded"
        d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
        mc:Ignorable="d">
    <Border BorderThickness="1"
            BorderBrush="{DynamicResource ShadcnBorderBrush}"
            CornerRadius="10"
            Background="{DynamicResource ShadcnBackgroundBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="56" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header / Toolbar -->
            <Border Grid.Row="0"
                    Background="{DynamicResource ShadcnCardBrush}"
                    BorderBrush="{DynamicResource ShadcnBorderBrush}"
                    BorderThickness="0,0,0,1"
                    CornerRadius="10,10,0,0"
                    MouseEnter="ControlBar_MouseEnter"
                    MouseLeftButtonDown="ControlBar_MouseLeftButtonDown">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Logo and App Name -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Image Height="28"
                               Source="/Images/logo.png"
                               RenderOptions.BitmapScalingMode="HighQuality" />
                        <TextBlock Margin="12,0,0,0"
                                   VerticalAlignment="Center"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource ShadcnForegroundBrush}"
                                   Text="Availability Compass" />
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,16,0">

                        <!-- Theme Toggle -->
                        <Button Style="{StaticResource ShadcnGhostButton}"
                                Command="{Binding ToggleThemeCommand}"
                                ToolTip="Toggle theme"
                                Padding="8"
                                Width="36"
                                Height="36">
                            <materialDesign:PackIcon Width="18" Height="18"
                                                     Kind="{Binding ThemeIcon}"
                                                     Foreground="{DynamicResource ShadcnForegroundBrush}" />
                        </Button>

                        <Rectangle Width="1"
                                   Height="24"
                                   Fill="{DynamicResource ShadcnBorderBrush}"
                                   Margin="8,0" />

                        <!-- Calendars Button -->
                        <Button Style="{StaticResource ShadcnToolbarButton}"
                                Command="{Binding OpenCalendarsCommand}"
                                ToolTip="Manage calendars">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Width="16" Height="16"
                                                         Kind="Calendar"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource ShadcnForegroundBrush}" />
                                <TextBlock Text="Calendars"
                                           Margin="6,0,0,0"
                                           VerticalAlignment="Center"
                                           Foreground="{DynamicResource ShadcnForegroundBrush}" />
                            </StackPanel>
                        </Button>

                        <!-- Sources Button -->
                        <Button Style="{StaticResource ShadcnToolbarButton}"
                                Command="{Binding OpenSourcesCommand}"
                                ToolTip="Manage sources"
                                Margin="4,0,0,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Width="16" Height="16"
                                                         Kind="Database"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource ShadcnForegroundBrush}" />
                                <TextBlock Text="Sources"
                                           Margin="6,0,0,0"
                                           VerticalAlignment="Center"
                                           Foreground="{DynamicResource ShadcnForegroundBrush}" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Window Control Buttons -->
                    <StackPanel Grid.Column="3"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Button Style="{StaticResource ShadcnIconButton}"
                                Click="BtnMinimize_Click"
                                ToolTip="Minimize"
                                Width="32"
                                Height="32">
                            <materialDesign:PackIcon Kind="WindowMinimize"
                                                     Width="16"
                                                     Height="16"
                                                     Foreground="{DynamicResource ShadcnMutedForegroundBrush}" />
                        </Button>
                        <Button x:Name="BtnMaximize"
                                Style="{StaticResource ShadcnIconButton}"
                                Click="BtnMaximize_Click"
                                Command="{Binding MaximizeButtonPressedCommand}"
                                ToolTip="{Binding MaximizeToolTip}"
                                Width="32"
                                Height="32">
                            <ContentControl Content="{Binding MaximizeIcon}">
                                <ContentControl.Resources>
                                    <Style TargetType="materialDesign:PackIcon">
                                        <Setter Property="Width" Value="16" />
                                        <Setter Property="Height" Value="16" />
                                        <Setter Property="Foreground" Value="{DynamicResource ShadcnMutedForegroundBrush}" />
                                    </Style>
                                </ContentControl.Resources>
                            </ContentControl>
                        </Button>
                        <Button Style="{StaticResource ShadcnIconButton}"
                                Click="BtnClose_Click"
                                ToolTip="Close"
                                Width="32"
                                Height="32">
                            <materialDesign:PackIcon Kind="Close"
                                                     Width="16"
                                                     Height="16"
                                                     Foreground="{DynamicResource ShadcnMutedForegroundBrush}" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <materialDesign:DialogHost Grid.Row="1"
                                       DialogContentUniformCornerRadius="12"
                                       DialogTheme="Inherit"
                                       Identifier="MainDialogHost"
                                       CloseOnClickAway="False"
                                       IsOpen="{Binding IsDialogOpen, Mode=OneWay}"
                                       Background="{DynamicResource ShadcnBackgroundBrush}">
                <materialDesign:DialogHost.DialogContent>
                    <ContentControl Margin="8"
                                    Content="{Binding CurrentDialogViewModel}" />
                </materialDesign:DialogHost.DialogContent>

                <!-- Search View Content -->
                <ContentControl Margin="16"
                                Content="{Binding SearchViewModel}" />
            </materialDesign:DialogHost>
        </Grid>
    </Border>
</Window>
